@using Microsoft.Extensions.Configuration
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
@inject IConfiguration Configuration
@using System.Security.Claims
<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Primary Meta Tags -->
    <title>AI Resume Screening | AI Screen Max</title>
    <meta name="title" content="AI Resume Screening | AI Screen Max">
    <meta name="description" content="AI Screen Max helps you screen resumes instantly using advanced AI. Upload resumes and get match percentage, insights, and recommended hiring actions.">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://aiscreenmax.my/">
    <meta property="og:title" content="AI Resume Screening | AI Screen Max">
    <meta property="og:description" content="Upload resumes and let AI Screen Max evaluate candidates with intelligent scoring and hiring suggestions. Fast, accurate, and fully automated.">
    <meta property="og:image" content="https://aiscreenmax.my/Images/meta-preview.png">
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://aiscreenmax.my/">
    <meta property="twitter:title" content="AI Resume Screening | AI Screen Max">
    <meta property="twitter:description" content="Smart AI resume screening tool that delivers match scores, strengths, and hiring recommendations. Speed up your recruitment process with AI.">
    <meta property="twitter:image" content="https://aiscreenmax.my/Images/meta-preview.png">
    <!-- SEO Extras -->
    <meta name="robots" content="index, follow">
    <meta name="author" content="AI Screen Max">
    <meta name="keywords" content="AI resume screening, resume analysis, candidate matching, resume parser, recruitment AI, HR automation, AI recruiting tool, hiring assistant">

    <title>@Configuration["ProjectName"]</title>
    <link rel="apple-touch-icon" sizes="180x180" href="~/images/Max_logo_2.png">
    <link rel="icon" type="image/png" sizes="32x32" href="~/images/icon32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="~/images/icon16.png">
    <link rel="shortcut icon" type="image/x-icon" href="~/favicon.ico">
    <link rel="manifest" href="~/Images/manifest.json">
    <meta name="msapplication-TileImage" content="~/Images/mstile-150x150.png">
    <meta name="theme-color" content="#ffffff">
    <script src="~/vendor/simplebar/simplebar.min.js"></script>
    <script src="~/js/config.js"></script>

    <!-- ===============================================-->
    <!--    Stylesheets az-->
    <!-- ===============================================-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@300;400;600;700;800;900&amp;display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <link href="~/vendor/simplebar/simplebar.min.css" rel="stylesheet">
    <link href="~/vendor/flatpickr/flatpickr.min.css" rel="stylesheet">
    <link href="~/vendor/dropzone/dropzone.css" rel="stylesheet" />
    <link href="~/fonts/unicons/css/line.css" type="text/css" rel="stylesheet">
    <link href="~/css/theme-rtl.min.css" type="text/css" rel="stylesheet" id="style-rtl">
    <link href="~/css/theme.min.css" type="text/css" rel="stylesheet" id="style-default">
    <link href="~/css/user-rtl.min.css" type="text/css" rel="stylesheet" id="user-style-rtl">
    <link href="~/css/user.min.css" type="text/css" rel="stylesheet" id="user-style-default">

    <link href="~/lib/datatables/css/datatables.bootstrap5.css" rel="stylesheet" />
    <link href="~/lib/datatables/css/datatables.checkboxes.css" rel="stylesheet" />
    <link href="~/css/mobilecss.css" rel="stylesheet" />
    <link href="~/css/jquery-ui.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">
    <link href="~/vendor/choices/choices.min.css" rel="stylesheet" />

    <style>
        .subscription-badge i,
        .subscription-badge span {
            transition: transform 0.3s ease, color 0.3s ease;
        }

        .subscription-badge:hover i,
        .subscription-badge:hover span {
            transform: scale(1.1);
            color: #157347; /* Bootstrap's darker success green */
        }

        .subscription-badge {
            cursor: pointer;
        }

        html[data-theme="dark"] .navbar-nav .rounded-circle {
            background-color: #000 !important;
            padding: 3px;
        }

    </style>
    <script>
        var phoenixIsRTL = window.config.config.phoenixIsRTL;
        if (phoenixIsRTL) {
          var linkDefault = document.getElementById('style-default');
          var userLinkDefault = document.getElementById('user-style-default');
          linkDefault.setAttribute('disabled', true);
          userLinkDefault.setAttribute('disabled', true);
          document.querySelector('html').setAttribute('dir', 'rtl');
        } else {
          var linkRTL = document.getElementById('style-rtl');
          var userLinkRTL = document.getElementById('user-style-rtl');
          linkRTL.setAttribute('disabled', true);
          userLinkRTL.setAttribute('disabled', true);
        }
    </script>
    @* <script src="~/lib/select2-4.1.0/js/select2.min.js"></script> *@
    <!-- ===============================================-->
    <!--    JavaScripts-->
    <!-- ===============================================-->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="~/css/common.css" rel="stylesheet" asp-append-version="true" />
    <script src="~/lib/datatables/js/jquery.datatables.js"></script>
    <script src="~/lib/datatables/js/datatables.bootstrap.js"></script>
    <script src="~/lib/datatables/js/datatables.select.js"></script>
    <script src="~/lib/datatables/js/datatables.bootstrap5.min.js"></script>
    <script src="~/lib/datatables/js/datatables.checkboxes.min.js"></script>

    <script src="~/vendor/popper/popper.min.js"></script>
    <script src="~/vendor/bootstrap/bootstrap.min.js"></script>
    <script src="~/vendor/anchorjs/anchor.min.js"></script>
    <script src="~/vendor/is/is.min.js"></script>
    <script src="~/vendor/fontawesome/all.min.js"></script>
    <script src="~/vendor/lodash/lodash.min.js"></script>
    <script src="~/vendor/list.js/list.min.js"></script>
    <script src="~/vendor/feather-icons/feather.min.js"></script>
    <script src="~/vendor/dayjs/dayjs.min.js"></script>
    <script src="~/vendor/tinymce/tinymce.min.js"></script>
    <script src="~/js/phoenix.js"></script>
    <script src="~/js/userprofile.js"></script>
    <script src="~/js/mainjs.js"></script>
    <script src="~/vendor/dropzone/dropzone-min.js"></script>
    <script src="~/vendor/dayjs/dayjs.min.js"></script>
    <script src="~/vendor/flatpickr/flatpickr.min.js"></script>
    <script src="~/vendor/prism/prism.js"></script>
    <script src="~/vendor/choices/choices.min.js"></script>

</head>
@{
    var username = HttpContextAccessor.HttpContext.Request.Cookies["NAME"]
                          ?? User.FindFirst(ClaimTypes.Name)?.Value
                          ?? User.Identity?.Name
                          ?? "Guest";
    var profileImage = HttpContextAccessor.HttpContext.Request.Cookies["PROFILE_IMAGE"];
    var useremail = HttpContextAccessor.HttpContext.Request.Cookies["EMAIL"];
    var userID = HttpContextAccessor.HttpContext.Request.Cookies["USER_ID"];
    // var userPlan = HttpContextAccessor.HttpContext.Request.Cookies["USER_PLAN"];
    var authenticationType = HttpContextAccessor.HttpContext.Request.Cookies["AUTH_TYPE"];
}

<body style="visibility:hidden; transition:none !important;">
    <!--TOAST-->
    <div class="ms-toast-container"></div>
    <!-- Loading Spinner -->
    <div class="spanner">
        <img src="~/Images/loading12.gif" alt="Loading" style="width: 85px; height: auto" />
    </div>

    <main class="main" id="top">

        <!-- START Vertical Sidebar -->
        @{
            var currentController = ViewContext.RouteData.Values["Controller"]?.ToString();
            var currentAction = ViewContext.RouteData.Values["Action"]?.ToString();
        }

        @if (currentController == "AiResume" && currentAction == "Index")
        {
            <nav class="navbar navbar-vertical navbar-expand-lg d-block">
                <div class="navbar-vertical-content">
                    <ul class="navbar-nav flex-column" id="navbarVerticalNav">
                        <li class="nav-item">
                            <a class="nav-link d-flex justify-content-between align-items-center" data-bs-toggle="collapse"
                               href="#cachedResumeCollapse" role="button" aria-expanded="false" aria-controls="cachedResumeCollapse">
                                <div class="d-flex align-items-center">
                                    <span class="nav-link-icon"><span data-feather="layers"></span></span>
                                    <span class="nav-link-text">Cached Resumes</span>
                                </div>
                                <i class="bi bi-chevron-down ms-2"></i>
                            </a>
                            <div class="collapse" id="cachedResumeCollapse">
                                <ul class="nav flex-column ms-4 mt-2" id="cachedResumeListSidebar" style="max-height: 300px; overflow-y: auto;"></ul>
                            </div>
                        </li>
                    </ul>
                    <div class="navbar-vertical-footer mt-auto">
                        <button class="btn navbar-vertical-toggle border-0 fw-semibold w-100 white-space-nowrap d-flex align-items-center">
                            <span class="uil uil-left-arrow-to-left fs-8"></span>
                            <span class="uil uil-arrow-from-right fs-8"></span>
                            <span class="navbar-vertical-footer-text ms-2">Collapsed View</span>
                        </button>
                    </div>
                </div>
            </nav>
        }
        }

        <nav class="navbar navbar-top fixed-top navbar-expand-lg" id="navbarTop">
            <div class="navbar-logo">

                <!-- Mobile Sidebar Toggle -->
                <button class="btn btn-sm d-lg-none me-2" id="mobileSidebarToggle" style="border:none; background:none;">
                    <i id="sidebarIcon" class="fa fa-history"></i>
                </button>

                <button class="btn navbar-toggler navbar-toggler-humburger-icon hover-bg-transparent" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTopCollapse" aria-controls="navbarTopCollapse" aria-expanded="false" aria-label="Toggle Navigation"><span class="navbar-toggle-icon"><span class="toggle-line"></span></span></button>
                <a class="navbar-brand me-1 me-sm-3" href="/AiResume/Index">
                    <div class="d-flex align-items-center">
                        <div class="d-flex align-items-center">
                            <img src="~/Images/AIScreenMaxLogo1.png" alt="MaxSystem" width="60" style="background-color: transparent" />
                            <h5 class="logo-text ms-2 d-none d-sm-block">AI Screen Max</h5>
                        </div>
                    </div>
                </a>
            </div>
            <div class="collapse navbar-collapse navbar-top-collapse order-1 order-lg-0 justify-content-center" id="navbarTopCollapse">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" href="/AiResume/Index">Screening Resume</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/AiResume/History">History</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/AiResume/ShortListed">Shortlisted</a>
                    </li>
                    @* <li class="nav-item">
                        <a class="nav-link" href="/AiResume/Guide">Guide</a>
                    </li> *@
                    <li class="nav-item">
                        <a class="nav-link" href="/Resume/Subscription">Pricing</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/Resume/HelpCenter">Help Center</a>
                    </li>
                </ul>
            </div>

            <ul class="navbar-nav navbar-nav-icons flex-row align-items-center mb-0">

                <!-- Theme Toggle -->
                <li class="nav-item d-flex align-items-center">
                    <div class="theme-control-toggle d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                        <input class="form-check-input ms-0 theme-control-toggle-input" type="checkbox"
                               data-theme-control="phoenixTheme" value="dark" id="themeControlToggle" />
                        <label class="mb-0 theme-control-toggle-label theme-control-toggle-light" for="themeControlToggle"
                               title="Switch theme">
                            <span class="icon" data-feather="moon"></span>
                        </label>
                        <label class="mb-0 theme-control-toggle-label theme-control-toggle-dark" for="themeControlToggle"
                               title="Switch theme">
                            <span class="icon" data-feather="sun"></span>
                        </label>
                    </div>
                </li>

                <!-- Notification Bell -->
                <li class="nav-item dropdown d-flex align-items-center justify-content-center mx-2">
                    <a class="nav-link p-0 d-flex align-items-center justify-content-center"
                       href="#" id="notificationDropdown"
                       role="button" data-bs-toggle="dropdown" aria-expanded="false"
                       style="width: 32px; height: 32px;">
                        <span class="d-block"><span class="icon" data-feather="bell" style="height:20px;width:20px;"></span></span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-end notification-dropdown-menu py-0 shadow border navbar-dropdown-caret"
                         style="left: auto; right: 0; transform: none; min-width: 400px; max-width: 95vw; width: 100%; ">
                        <div class="card position-relative border-0">
                            <div class="card-header p-2">
                                <div class="d-flex justify-content-between">
                                    <h5 class="text-body-emphasis mb-0">Notifications</h5>
                                    <button class="btn btn-link p-0 fs-9 fw-normal" type="button">Mark all as read</button>
                                </div>
                            </div>
                            <div class="card-body p-0">
                                <div class="scrollbar-overlay">
                                    <div class="px-2 px-sm-3 py-3 notification-card position-relative read border-bottom">
                                        <div class="d-flex align-items-center justify-content-between position-relative">
                                            No Notification
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer p-0 border-top border-translucent border-0">
                                <div class="my-2 text-center fw-bold fs-10 text-body-tertiary text-opacity-85">
                                    <a class="fw-bolder" href="#">Notification history</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </li>

                <!-- Profile Dropdown -->
                <li class="nav-item dropdown d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                    <a class="nav-link p-0 d-flex align-items-center justify-content-center"
                       href="#" id="navbarDropdownUser"
                       role="button" data-bs-toggle="dropdown" aria-expanded="false"
                       style="width: 32px; height: 32px;">

                        @if (User.Identity.IsAuthenticated)
                        {
                            <img src="@(string.IsNullOrEmpty(profileImage) ? Url.Content("~/Images/user-avatar.png") : profileImage)"
                                 id="img-userprofile"
                                 alt="user profile"
                                 class="img-userprofile rounded-circle"
                                 style="width: 28px; height: 28px; object-fit: cover;" />

                        }
                        else
                        {
                            <img class="rounded-circle" src="~/Images/user-avatar.png" alt="Guest" style="width: 28px; height: 28px; object-fit: cover;" />
                        }
                    </a>
                    <input type="hidden" value="@useremail" id="txtuseremail" />
                    <input type="hidden" value="@userID" id="txtUserID" />
                    <input type="hidden" value="free" id="UserPlan" />

                    <div class="dropdown-menu dropdown-menu-end navbar-dropdown-caret py-0 dropdown-profile shadow border" aria-labelledby="navbarDropdownUser">
                        <div class="card position-relative border-0">
                            <div class="card-body p-0">
                                <div class="text-center pt-4 pb-3">
                                    <div class="avatar avatar-xl ">

                                        <input type="hidden" value="@useremail" id="txtuseremail" />
                                        <input type="hidden" value="@userID" id="txtUserID" />
                                        <input type="hidden" value="free" id="UserPlan" />

                                        @if (User.Identity.IsAuthenticated)
                                        {

                                            if (string.IsNullOrEmpty(profileImage))
                                            {

                                                <img class="rounded-circle img-userprofile" src="~/Images/user-avatar.png" alt="user image" />
                                            }
                                            else
                                            {
                                                <img src="@(string.IsNullOrEmpty(profileImage) ? Url.Content("~/Images/user-avatar.png") : profileImage)"
                                                     id="img-userprofile"
                                                     alt="user profile"
                                                     class="img-userprofile rounded-circle"
                                                     style="width: 100%; height: 100%; object-fit: cover; border: 1px solid #ddd;"
                                                     referrerpolicy="no-referrer"
                                                     onerror="this.onerror=null; this.src='/Images/user-avatar.png';" />
                                            }
                                        }
                                        else
                                        {
                                            <div class="d-flex justify-content-center align-items-center" style="height: 60px;">
                                                <img class="rounded-circle"
                                                     src="~/Images/user-avatar.png"
                                                     alt="Guest"
                                                     style="width: 40px; height: 40px; object-fit: cover;" />
                                            </div>
                                        }
                                    </div>
                                    <h6 class="mt-2 text-body-emphasis" style="padding: 5px;">
                                        @(User.Identity.IsAuthenticated ? username : "Login Required")
                                    </h6>
                                    @if (User.Identity.IsAuthenticated)
                                    {
                                        <span class="badge rounded-pill bg-light-success text-success d-inline-flex align-items-center px-3 py-1 subscription-badge">
                                            <i class="bi bi-patch-check-fill me-2" style="font-size: 1rem;"></i>
                                            <span class="fs-10">Subscription : Startup</span>
                                        </span>
                                    }
                                </div>
                            </div>

                            <div class="overflow-auto scrollbar" style="height: auto;">
                                <ul class="nav d-flex flex-column mb-2 pb-1">
                                    @if (User.Identity.IsAuthenticated)
                                    {
                                        <li class="nav-item"><a class="nav-link px-3 d-block" href="../Resume/HelpCenter"><span class="me-2 text-body align-bottom" data-feather="help-circle"></span>Help Center</a></li>
                                    }
                                </ul>
                            </div>

                            <div class="card-footer p-0 border-top border-translucent">
                                @if (User.Identity.IsAuthenticated)
                                {
                                    <div class="mt-3 px-3">
                                        <a href="@Url.Action("SignOut2", "Account")" class="btn btn-phoenix-danger d-flex flex-center w-100">
                                            <span class="me-2" data-feather="log-out"></span>Sign Out
                                        </a>

                                    </div>
                                }
                                else
                                {
                                    <div class="mt-3 px-3">
                                        <a class="btn btn-outline-primary d-flex align-items-center justify-content-center w-100"
                                           asp-area="MicrosoftIdentity" asp-controller="Account" asp-action="Sign">
                                            <img src="~/Images/Microsoft_logo.svg" style="height: 20px; margin-right: 8px;" /> Sign in with Microsoft
                                        </a>
                                    </div>
                                    <div class="mt-2 px-3">
                                        <a class="btn btn-outline-danger d-flex align-items-center justify-content-center w-100"
                                           href="/login-google">
                                            <img src="~/Images/glogo.png" style="height: 20px; margin-right: 8px; background-color: transparent;" /> Sign in with Google
                                        </a>
                                    </div>
                                }

                                <div class="my-2 text-center fw-bold fs-10 text-body-quaternary">
                                    <a class="text-body-quaternary me-1" href="#" data-bs-toggle="modal" data-bs-target="#termsModal">Privacy policy</a> &bull;
                                    <a class="text-body-quaternary mx-1" href="#" data-bs-toggle="modal" data-bs-target="#termsModal">Terms</a>
                                </div>
                                <div class="text-center text-muted fs-10 mb-3">
                                    Powered by <strong>Max System Solution Sdn Bhd</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
            </div>
        </nav>
        </header>
        <div class="content @(currentController == "AiResume" && currentAction == "Index" ? "ms-lg-15" : "")">
            @RenderBody()
            @* <footer class="footer position-absolute">
                <div class="row g-0 justify-content-between align-items-center h-100">
                    <div class="col-12 col-sm-auto text-center">
                        <p class="mb-0 mt-2 mt-sm-0 text-body">Thank you for creating with Phoenix<span class="d-none d-sm-inline-block"></span><span class="d-none d-sm-inline-block mx-1">|</span><br class="d-sm-none" />2025 &copy;<a class="mx-1" href="https://themewagon.com">Themewagon</a></p>
                    </div>
                    <div class="col-12 col-sm-auto text-center">
                        <p class="mb-0 text-body-tertiary text-opacity-85">v1.22.0</p>
                    </div>
                </div>
            </footer> *@
        </div>


        <!-- Terms and Policy Modal -->
        <div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
                <div class="modal-content shadow-sm border-0">
                    <div class="modal-header bg-white text-dark border-bottom">
                        <h5 class="modal-title" id="termsModalLabel">
                            <i class="fas fa-file-contract me-2"></i> Terms and Conditions
                        </h5>
                        <button class="btn-close btn-close-white p-1" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body small text-body px-4 py-3">
                        <p><strong>Effective as of June 20, 2025</strong></p>

                        <p>
                            <strong>1. Overview</strong><br />
                            These Terms and Conditions apply to the use of the AI Resume Screening platform by Max System Solution. By using the service, you agree to comply with these terms under Malaysian law.
                        </p>

                        <p>
                            <strong>2. Use of Service</strong><br />
                            - Upload resumes in supported formats (PDF, Word, or image).<br />
                            - Free users are limited to a set number of scans per month.<br />
                            - Premium users gain batch upload & detailed scoring reports access.
                        </p>

                        <p>
                            <strong>3. Data Privacy</strong><br />
                            We comply with the Personal Data Protection Act 2010 (PDPA). Uploaded data is used solely for screening and deleted after 90 days unless extended by the user.
                        </p>

                        <p>
                            <strong>4. Intellectual Property</strong><br />
                            All platform code and AI models are proprietary to Max System Solution. Users are not permitted to reverse engineer or redistribute the system without prior consent.
                        </p>

                        <p>
                            <strong>5. Limitation of Liability</strong><br />
                            We are not liable for hiring outcomes based on AI-generated analysis. The platform may produce errors when handling poorly formatted or non-standard resume files.
                        </p>

                        <p>
                            <strong>6. Subscriptions</strong><br />
                            - Subscriptions are billed monthly or annually.<br />
                            - Users can cancel at any time. Access remains valid through the billing cycle.<br />
                            - No refunds for partial periods.
                        </p>

                        <p>
                            <strong>7. Governing Law</strong><br />
                            This agreement is governed by the laws of Malaysia. Legal disputes will be handled by the appropriate Malaysian courts.
                        </p>

                        <p>
                            <strong>8. Changes to Terms</strong><br />
                            We may revise these terms at any time. Updates will be posted on this page and major changes may be communicated via email.
                        </p>

                        <p>
                            <strong>9. Contact Us</strong><br />
                            For inquiries, please email us at <a href="mailto:hr@maxsys.com.my">hr@maxsys.com.my</a>.
                        </p>

                        <p>
                            <strong>10. AI Usage Disclaimer</strong><br />
                            This platform uses AI to analyze resumes. While we aim for accuracy, the results are not guaranteed. This tool is designed to assist, not replace, human judgment in hiring decisions.
                        </p>
                    </div>
                    <div class="modal-footer border-0 justify-content-end">
                        <button class="btn btn-primary" type="button" data-bs-dismiss="modal">Agree & Close</button>
                    </div>
                </div>
            </div>
        </div>


        <script>
            var navbarTopStyle = window.config.config.phoenixNavbarTopStyle;
            var navbarTop = document.querySelector('.navbar-top');
            if (navbarTopStyle === 'darker') {
              navbarTop.setAttribute('data-navbar-appearance', 'darker');
            }

            var navbarVerticalStyle = window.config.config.phoenixNavbarVerticalStyle;
            var navbarVertical = document.querySelector('.navbar-vertical');
            if (navbarVertical && navbarVerticalStyle === 'darker') {
              navbarVertical.setAttribute('data-navbar-appearance', 'darker');
            }
        </script>
    </main>
    <footer class="footer text-center py-3 mt-auto border-top">
        <small>
            &copy; @DateTime.Now.Year Powered by <strong>Max System Solution Sdn Bhd</strong>
        </small>
    </footer>


    @RenderSection("Scripts", required: false)
    <script>
        $(window).on('load', function () {
            if (window.innerWidth < 576) {
                // Optional carousel height fix
                $('.carousel-inner').css('min-height', '180px');

                // Force Bootstrap recalculation
                setTimeout(() => {
                    window.dispatchEvent(new Event('resize'));
                    document.body.style.zoom = "1";
                    document.body.style.visibility = "visible"; // Show after everything is ready
                }, 300);
            } else {
                // Desktop view — just show immediately
                document.body.style.visibility = "visible";
            }
        });
    </script>
    <script>
        // Sidebar collapse toggle
        document.querySelector('.navbar-vertical-toggle')?.addEventListener('click', () => {
            document.querySelector('.navbar-vertical')?.classList.toggle('collapsed');
        });
    </script>
    
    <script>
        const toggleBtn = document.getElementById('mobileSidebarToggle');
        const sidebar = document.querySelector('.navbar-vertical');
        const icon = document.getElementById('sidebarIcon');

        toggleBtn?.addEventListener('click', () => {
          sidebar.classList.toggle('show-mobile');

          // Ensure icon exists
          if (icon) {
            const isOpen = sidebar.classList.contains('show-mobile');
            icon.className = isOpen ? 'fa fa-times' : 'fa fa-history';
          }
        });
    </script>
    <script>
        window.addEventListener('load', () => {
            feather.replace(); // <-- This renders the icons inside sidebar (like bookmark, file-text)
        });
    </script>
    <script>
       function populateCachedResumeDropdown() {
    const cached = localStorage.getItem("ai_resume_sessions");
    const sidebarDropdown = document.getElementById("cachedResumeListSidebar");

    if (!cached || !sidebarDropdown) return;

    const sessions = JSON.parse(cached);
    sidebarDropdown.innerHTML = "";

    sessions.forEach((session, index) => {
        const label = `${session.jobtitle || "Untitled"} (${new Date(session.resumes[0]?.timestamp).toLocaleString()})`;

        const itemHtml = `
            <li class="nav-item">
                <a class="nav-link px-0 py-1 text-secondary" href="#" onclick="loadSingleCachedResume(${index})">
                    <i class="bi bi-person-circle me-2"></i>${label}
                </a>
            </li>
        `;
        sidebarDropdown.insertAdjacentHTML("beforeend", itemHtml);
    });
}

// ✅ Correct place for it:
window.addEventListener("DOMContentLoaded", populateCachedResumeDropdown);
    </script>
    <script>
            function loadSingleCachedResume(index) {
            const cached = JSON.parse(localStorage.getItem("ai_resume_sessions") || "[]");
            const selected = cached[index];
            if (!selected) return;

            // Set the selected session ID if needed
            $('#sessionSelect').val(selected.id);

            // Set job title
            const titleInput = document.getElementById("txtTitle");
            if (titleInput) titleInput.value = selected.jobtitle || "";

            // Set job description using TinyMCE
            if (tinymce.get("txtJobDescription")) {
                tinymce.get("txtJobDescription").setContent(selected.jobDesc || "");
            }

            // Load resumes into the table
            const table = $('#example').DataTable();
            table.clear();

            selected.resumes.forEach(response => {
                const newRow = table.row.add([
                    `${response.name}<br><a href="mailto:${response.email}">${response.email}</a><br><a href="tel:${response.phone_number}">${response.phone_number}</a>`,
                    `<div style="text-align:center;">${response.percentage_match}%</div>`,
                    response.short_description,
                    response.short_listed ? '' : `<div class="text-center"><button class="btn btn-success btn-sm shortlisted"><i class="fas fa-check"></i></button></div>`
                ]).draw(false).node();

                $(newRow).data("resume", response);
            });
        }
    </script>
</body>
</html>
